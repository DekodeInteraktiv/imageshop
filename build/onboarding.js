(()=>{"use strict";var e={n:t=>{var a=t&&t.__esModule?()=>t.default:()=>t;return e.d(a,{a}),a},d:(t,a)=>{for(var o in a)e.o(a,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:a[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.element,a=window.React;var o=e.n(a);const n=window.ReactDOM;var s=e.n(n);const r=window.wp.i18n,l=e=>{let{setStep:a}=e;return(0,t.createElement)(t.Fragment,null,(0,t.createElement)("p",null,(0,r.__)("After setup, Imageshop will become your one source of truth for all media on your site.","imageshop")),(0,t.createElement)("div",{className:"imageshop-modal-actions"},(0,t.createElement)("button",{type:"button",className:"button button-primary",onClick:()=>a(2)},(0,r.__)("Start setup","imageshop")),(0,t.createElement)("a",{href:"https://imageshop.no",className:"pull-right",target:"_blank",rel:"noopener noreferrer"},(0,r.__)("Create an account","imageshop"))))},m=window.wp.apiFetch;var i=e.n(m);const c=e=>{let{setStep:o}=e;const[n,s]=(0,a.useState)(""),[l,m]=(0,a.useState)(!1),[c,p]=(0,a.useState)("");return(0,t.createElement)(t.Fragment,null,(0,t.createElement)("p",null,(0,r.__)("Enter your API token here. You can find your API token in your ImageShop account.","imageshop")),c&&(0,t.createElement)(t.Fragment,null,l&&(0,t.createElement)("p",{className:"valid-token"},(0,r.__)("✔ Your API token is valid.","imageshop")),!l&&(0,t.createElement)(t.Fragment,null,(0,t.createElement)("p",{className:"invalid-token"},(0,r.__)("❌ Your API token is invalid:","imageshop")),(0,t.createElement)("p",{className:"invalid-token"},c))),(0,t.createElement)("input",{type:"text",value:n,onChange:e=>s(e.target.value)}),(0,t.createElement)("div",{className:"imageshop-modal-actions"},!l&&(0,t.createElement)("button",{type:"button",className:"button button-primary",onClick:()=>{i()({path:"/imageshop/v1/onboarding/token",method:"POST",data:{token:n}}).then((e=>{m(e.valid),p(e.message)})).catch((e=>{m(e.valid),p(e.message)}))}},(0,r.__)("Test API token","imageshop")),l&&(0,t.createElement)("button",{type:"button",className:"button button-primary",onClick:()=>o(3)},(0,r.__)("Continue to upload settings","imageshop"))))},p=window.wp.components,u=e=>{let{setStep:o}=e;const[n,s]=(0,t.useState)(),[l,m]=(0,t.useState)([]);return(0,a.useEffect)((()=>{i()({path:"/imageshop/v1/onboarding/interfaces"}).then((e=>{const t=[];t.push({value:"",label:(0,r.__)("Select an interface","imageshop")}),e.interfaces.map((e=>{const a={value:e.Id,label:e.Name};t.push(a)})),m(t)}))}),[]),(0,a.useEffect)((()=>{n&&i()({path:"/imageshop/v1/onboarding/interfaces",method:"POST",data:{interface:n}})}),[n]),(0,t.createElement)(t.Fragment,null,(0,t.createElement)("p",null,(0,r.__)("Interfaces determine where files are stored in your Imageshop account.","imageshop")),(0,t.createElement)(p.SelectControl,{label:(0,r.__)("Select which interface is used for uploaded media files","imageshop"),options:l,onChange:e=>s(e)}),(0,t.createElement)("div",{className:"imageshop-modal-actions"},n&&(0,t.createElement)("button",{type:"button",className:"button button-primary",onClick:()=>o(4)},(0,r.__)("Continue to imports","imageshop"))))},d=e=>{let{setStep:o}=e;const[n,s]=(0,a.useReducer)(((e,t)=>({...e,...t})),{progressImported:0,progressTotal:0,doingImport:!1}),{progressImported:l,progressTotal:m,doingImport:c}=n;let p;const u=()=>{clearTimeout(p),i()({path:"/imageshop/v1/onboarding/completed"}).then((()=>{o(5)}))},d=()=>{i()({path:"/imageshop/v1/onboarding/import",method:"GET"}).then((e=>{s({progressImported:e.imported,progressTotal:e.total}),p=setTimeout(d,5e3)}))};return(0,a.useEffect)((()=>{m<=0||m===l&&u()}),[m,l]),(0,t.createElement)(t.Fragment,null,(0,t.createElement)("p",null,(0,r.__)("Would you like to import your current media library to Imageshop?","imageshop")),(0,t.createElement)("p",null,(0,r.__)("By importing your media library, you ensure that it will remain available to insert into new posts or pages, and also makes it available to the rest of your organization via the normal Imageshop interfaces and other integrations.","imageshop")),c&&(0,t.createElement)("div",{className:"imageshop-import-progress-indicator"},(0,t.createElement)("label",{htmlFor:"imageshop-import-progress"},(0,r.__)("Import Progress","imageshop")),(0,t.createElement)("progress",{id:"imageshop-import-progress",value:l,max:m})),(0,t.createElement)("div",{className:"imageshop-modal-actions"},(0,t.createElement)("button",{type:"button",className:"button button-primary",onClick:()=>(s({doingImport:!0}),void i()({path:"/imageshop/v1/onboarding/import",method:"POST"}).then((e=>{d()}))),disabled:c},(0,r.__)("Import existing media","imageshop")),(0,t.createElement)("button",{type:"button",className:"button button-secondary",onClick:()=>u(),disabled:c},(0,r.__)("Continue without importing media","imageshop"))))},g=e=>{let{setShowWizard:a,setShowNotice:o}=e;return(0,t.createElement)(t.Fragment,null,(0,t.createElement)("p",null,(0,r.__)("Your site has now been configured to use all media via Imageshop.","imageshop")),(0,t.createElement)("div",{className:"imageshop-modal-actions"},(0,t.createElement)("button",{type:"button",className:"button button-primary",onClick:()=>(o(!1),void a(!1))},(0,r.__)("Finish setup","imageshop"))))},h=e=>{let{setShowWizard:o,setShowNotice:n}=e;const[s,m]=(0,a.useState)(1);return(0,t.createElement)(t.Fragment,null,(0,t.createElement)("div",{className:"imageshop-modal-overlay"},(0,t.createElement)("div",{className:"imageshop-wizard-wrapper"},(0,t.createElement)("dialog",{className:"imageshop-wizard"},(0,t.createElement)("div",{className:"imageshop-modal-header"},(0,t.createElement)("h2",null,(0,r.__)("Imageshop setup","imageshop")),(0,t.createElement)("button",{type:"button",className:"imageshop-modal-close",onClick:()=>o(!1)},(0,t.createElement)("span",{className:"dashicons dashicons-no"}),(0,t.createElement)("span",{className:"screen-reader-text"},(0,r.__)("Close Imageshop setup modal","imageshop")))),(0,t.createElement)("div",{className:"imageshop-modal-body"},1===s&&(0,t.createElement)(l,{setStep:m}),2===s&&(0,t.createElement)(c,{setStep:m}),3===s&&(0,t.createElement)(u,{setStep:m}),4===s&&(0,t.createElement)(d,{setStep:m}),5===s&&(0,t.createElement)(g,{setShowNotice:n,setShowWizard:o}))))))},E=()=>{const[e,o]=(0,a.useState)(!0),[n,s]=(0,a.useState)(!1);return(0,a.useEffect)((()=>{window.addEventListener("keydown",(e=>{"Escape"===e.key&&s(!1)}))}),[]),(0,a.useEffect)((()=>{const e=document.querySelector("body");n?e.classList.add("disable-scroll"):e.classList.remove("disable-scroll")}),[n]),e?(0,t.createElement)(t.Fragment,null,(0,t.createElement)("div",{className:"notice notice-warning inline"},(0,t.createElement)("h2",null,(0,r.__)("Imageshop setup","imageshop")),(0,t.createElement)("p",null,(0,r.__)("The Imageshop integration is almost ready to use, please complete the setup steps to start using Imageshop directly from your media library.","imageshop")),(0,t.createElement)("p",null,(0,t.createElement)("button",{type:"button",className:"button button-primary",onClick:()=>s(!0)},(0,r.__)("Complete setup","imageshop")))),n&&(0,t.createElement)(h,{setShowWizard:s,setShowNotice:o})):(0,t.createElement)(t.Fragment,null)},b=document.getElementById("imageshop-onboarding");b&&s().render((0,t.createElement)(o().StrictMode,null,(0,t.createElement)((()=>(0,t.createElement)(t.Fragment,null,(0,t.createElement)(E,null))),null)),b)})();